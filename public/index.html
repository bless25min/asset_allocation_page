<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è³‡ç”¢é…ç½®æ¨¡æ“¬å™¨ (Embed)</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="embed.css">
    <link rel="stylesheet" href="auth.css">
    <link rel="icon" type="image/png" href="favicon.png">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        /* Embed Overrides for clean fit */
        body {
            background-color: transparent !important;
            /* Allow iframe parent bg to show if needed, or set specific */
            padding: 0;
            margin: 0;
        }

        .section {
            padding: 1rem 0;
            /* Reduce padding for widget */
        }

        .simulator-section {
            border-radius: 0;
            /* Full width widget usually doesn't need outer radius if in iframe */
            min-height: 100vh;
            /* Ensure full height usage */
        }

        .container {
            width: 100%;
            max-width: 100%;
            padding: 0 1rem;
        }
    </style>
</head>

<body>

    <!-- Embed Launcher (Hidden by default, shown via JS if mode=embed) -->
    <div id="embed-launcher" class="embed-launcher hidden">
        <div class="launcher-content">
            <h3>è³‡ç”¢é…ç½®æ¨¡æ“¬å™¨</h3>
            <p>é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹è¦åŠƒæ‚¨çš„è²¡å¯Œè—åœ–</p>
            <button id="btn-start-embed" class="btn btn-primary btn-pulse">
                <span class="icon">ğŸš€</span> é–‹å§‹ä½¿ç”¨
            </button>
            <div style="margin-top: 1rem;">
                <a id="btn-new-window" href="#" target="_blank" class="btn-text hidden">
                    â‹ åœ¨æ–°è¦–çª—é–‹å•Ÿ
                </a>
            </div>
        </div>
    </div>

    <!-- Exit Fullscreen Button (Fixed Overlay) -->
    <button id="btn-exit-fullscreen" class="btn-exit-fs hidden" title="é€€å‡ºå…¨è¢å¹•">
        âœ• é—œé–‰
    </button>

    <!-- User Panel (Top Right) -->
    <div id="user-panel" class="user-panel">
        <!-- Default State -->
        <a id="btn-login" href="#" class="btn-login">
            <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg" alt="LINE" width="20">
            ç™»å…¥ä¿å­˜
        </a>
        <!-- Logged In State (Hidden by default) -->
        <div id="user-info" class="user-info hidden">
            <img id="user-pic" src="" alt="User">
            <span id="user-name"></span>
            <button id="btn-logout" class="btn-logout" onclick="logout()">ç™»å‡º</button>
        </div>
    </div>

    <!-- Simulator Section (Standalone) -->
    <section id="simulator" class="section simulator-section">
        <div class="container">
            <!-- Header removed for embed, or kept minimal? -->
            <!-- <h2 class="section-title text-light">è³‡ç”¢é…ç½®ä¸‰ç¶­æ¨¡æ“¬å™¨ V2.0</h2> -->
            <!-- <p class="section-desc text-light">å‹•æ‰‹æ‹‰æ‹‰çœ‹ï¼Œç™¼ç¾ä½ çš„ã€Œé»ƒé‡‘æ¯”ä¾‹ã€ã€‚</p> -->

            <div class="simulator-container">

                <!-- Step 1 Inflation Calculator -->
                <div class="calc-card">
                    <h3>Step 1: ä½ çš„å°æ‰‹ (é€šè²¨è†¨è„¹)</h3>
                    <div class="calc-inputs">
                        <div class="input-group">
                            <label>æƒ³ä¸€å€‹ä½ æœ‰å°è±¡çš„æ¶ˆè²»</label>
                            <input type="text" id="calc-item" placeholder="ä¾‹å¦‚ï¼šä¾¿ç•¶/æˆ¿ç§Ÿ/æ—©é¤">
                        </div>
                        <div class="input-group">
                            <label>10 å¹´å‰çš„åƒ¹æ ¼</label>
                            <input type="number" id="calc-price-old" placeholder="70" value="70">
                        </div>
                        <div class="input-group">
                            <label>ç¾åœ¨çš„åƒ¹æ ¼</label>
                            <input type="number" id="calc-price-now" placeholder="100" value="100">
                        </div>
                        <button id="btn-calc-inflation" class="btn btn-primary">è¨ˆç®—æˆ‘çš„é€šè†¨ç‡</button>
                    </div>
                    <div id="calc-result" class="calc-result hidden">
                        ä½ çš„å€‹äººé€šè†¨ç‡ï¼š<span id="res-inflation-rate">--%</span> <br>
                        <small>é€™å°‡æ˜¯ä½ çš„æŠ•è³‡åŠæ ¼ç·šã€‚</small>
                    </div>
                </div>

                <!-- Step 2 Financial Inputs -->
                <div class="financial-inputs-section">
                    <h3>Step 2: ä½ çš„æˆ°åŠ› (è³‡ç”¢èˆ‡æ”¶å…¥)</h3>
                    <div class="fin-inputs-grid">
                        <div class="input-group">
                            <label>ç¾åœ¨è³‡ç”¢ç¸½è¨ˆ (Total Assets)</label>
                            <input type="number" id="inp-initial" value="1000000">
                        </div>
                        <div class="input-group">
                            <label>æ¯æœˆæ”¶å…¥ (Monthly Income)</label>
                            <input type="number" id="inp-monthly" value="20000">
                        </div>
                    </div>
                </div>

                <!-- Step 3 & 4 Dual Panels -->
                <div class="sim-panels-container">

                    <!-- Panel A -->
                    <div class="sim-panel panel-a">
                        <div class="panel-header">
                            <h3>Step 3: ä½ çš„ç¾æ³ (Plan A)</h3>

                        </div>
                        <div class="sim-inputs">
                            <div class="slider-group">
                                <label for="slider-a-cash">ç¾é‡‘/å®šå­˜ <span id="val-a-cash"
                                        class="val-display">100%</span></label>
                                <input type="range" id="slider-a-cash" min="0" max="100" value="100">
                            </div>
                            <div class="slider-group">
                                <label for="slider-a-etf">æŒ‡æ•¸æŠ•è³‡ <span id="val-a-etf"
                                        class="val-display">0%</span></label>
                                <input type="range" id="slider-a-etf" min="0" max="100" value="0">
                            </div>
                            <div class="slider-group">
                                <label for="slider-a-re">æˆ¿ç”¢/æ”¶ç§Ÿ <span id="val-a-re" class="val-display">0%</span></label>
                                <input type="range" id="slider-a-re" min="0" max="100" value="0">
                            </div>
                            <div class="slider-group">
                                <label for="slider-a-active">ä¸»å‹•äº¤æ˜“ <span id="val-a-active"
                                        class="val-display">0%</span></label>
                                <input type="range" id="slider-a-active" min="0" max="100" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- Panel B -->
                    <div class="sim-panel panel-b">
                        <div class="panel-header">
                            <h3>Step 4: ä½ çš„æœªä¾† (Plan B)</h3>

                        </div>
                        <div class="sim-inputs">
                            <div class="slider-group">
                                <label for="slider-b-cash">ç¾é‡‘/å®šå­˜ <span id="val-b-cash"
                                        class="val-display">100%</span></label>
                                <input type="range" id="slider-b-cash" min="0" max="100" value="100">
                            </div>
                            <div class="slider-group">
                                <label for="slider-b-etf">æŒ‡æ•¸æŠ•è³‡ <span id="val-b-etf"
                                        class="val-display">0%</span></label>
                                <input type="range" id="slider-b-etf" min="0" max="100" value="0">
                            </div>
                            <div class="slider-group">
                                <label for="slider-b-re">æˆ¿ç”¢/æ”¶ç§Ÿ <span id="val-b-re" class="val-display">0%</span></label>
                                <input type="range" id="slider-b-re" min="0" max="100" value="0">
                            </div>
                            <div class="slider-group">
                                <label for="slider-b-active">ä¸»å‹•äº¤æ˜“ <span id="val-b-active"
                                        class="val-display">0%</span></label>
                                <input type="range" id="slider-b-active" min="0" max="100" value="0">
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Scenario Text -->
                <div id="sim-feedback" class="sim-feedback"></div>

                <!-- Dashboard -->
                <div class="sim-dashboard">
                    <div class="stat-card">
                        <h4>é æœŸå ±é…¬ (Expected)</h4>
                        <div class="stat-value" id="out-return">--%</div>
                    </div>
                    <div class="stat-card">
                        <h4>æ¥µç«¯é¢¨éšª (Max Risk)</h4>
                        <div class="stat-value danger" id="out-risk">--%</div>
                    </div>
                    <div class="stat-card">
                        <h4>å¯¦ç¾æ©Ÿç‡ (Confidence)</h4>
                        <div class="stat-value success" id="out-prob">--%</div>
                    </div>
                </div>

                <!-- Action Buttons (New) -->
                <div class="action-buttons">
                    <button id="btn-save-sim" class="btn btn-secondary hidden">
                        ğŸ’¾ å„²å­˜æˆ‘çš„é…ç½®
                    </button>
                    <button id="btn-view-stats" class="btn btn-outline">
                        ğŸ“Š æŸ¥çœ‹å¤§å®¶æ€éº¼é…
                    </button>
                </div>

                <!-- Chart -->
                <div class="chart-container">
                    <h3>æœªä¾†è³‡ç”¢å·®è·é æ¸¬ (Wealth Projection)</h3>
                    <canvas id="wealthChart"></canvas>

                    <!-- Wealth Gap Card -->
                    <div class="wealth-gap-card" id="wealth-gap-card">
                        <div class="gap-label">20 å¹´å¾Œï¼Œä½ çš„è²¡å¯Œå·®è·å°‡é”åˆ°ï¼š</div>
                        <div class="gap-value" id="val-wealth-gap">è¨ˆç®—ä¸­...</div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Stats Modal (New) -->
    <div id="stats-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <button id="btn-close-stats" class="close-btn">&times;</button>
            <div class="stats-content">
                <!-- Stats Groups Filter -->
                <div id="stats-filters" class="stats-tabs">
                    <button class="active" onclick="switchStatsGroup('small')">å°è³‡æ—</button>
                    <button onclick="switchStatsGroup('middle')">ä¸­ç”¢éšç´š</button>
                    <button onclick="switchStatsGroup('large')">å¯Œè£•å±¤</button>
                </div>

                <div class="stats-content-grid">
                    <!-- Section 1: Inflation Observation (First) -->
                    <div class="stats-section">
                        <h5>ğŸ”¥ ç¤¾ç¾¤é€šè†¨è§€å¯Ÿ</h5>
                        <div id="stats-inf-box" class="inf-summary-box">
                            <!-- JS Inject -->
                        </div>
                    </div>

                    <!-- Section 2: Current Allocation (Panel A) -->
                    <div class="stats-section">
                        <h5>ğŸ  ç¾æ³å¹³å‡é…ç½® (Panel A)</h5>
                        <table class="stats-table">
                            <thead>
                                <tr>
                                    <th>è³‡ç”¢</th>
                                    <th>æ¯”ä¾‹</th>
                                </tr>
                            </thead>
                            <tbody id="stats-a-body">
                                <!-- JS Inject -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Section 3: Target Allocation (Panel B) -->
                    <div class="stats-section">
                        <h5>ğŸš€ ç›®æ¨™æœŸæœ›é…ç½® (Panel B)</h5>
                        <table class="stats-table">
                            <thead>
                                <tr>
                                    <th>è³‡ç”¢</th>
                                    <th>æ¯”ä¾‹</th>
                                </tr>
                            </thead>
                            <tbody id="stats-b-body">
                                <!-- JS Inject -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="modal-footer"
                    style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
                    <button id="btn-close-stats-footer" class="btn btn-secondary"
                        style="width: 100%; padding: 0.8rem; border-radius: 12px;">é—œé–‰</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="script.js"></script>
</body>

</html>